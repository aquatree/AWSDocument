# SQS

## FIFOキュー

* イベント順序が重要な場合に使用
  * メッセージグループID: メッセージの順序に使用。同じグループIDのメッセージは厳密に一つずつ処理される。
* 重複不可の場合に使用
  * メッセージ重複排除ID: メッセージの重複排除に使用されるトークン。同じメッセージ重複排除IDが来ると、正常に受け入れられるが5分間は配信されない
  * 受信リクエスト試行ID: メッセージの重複排除に使用されるトークン。`ReceiveMessage` 呼び出しの重複排除に使用。

## Amazon SQS 拡張クライアントライブラリ

* SQSが一度に送れるメッセージの最大サイズは256KB
* 拡張クライアントライブラリを使用することで2GBまで保存・処理が可能になる
  * 常にS3に保存/256KBを超えた場合のみ保存かを指定する
  * S3に保存されている単一のメッセージオブジェクトを参照するメッセージを送信する
  * S3から該当メッセージオブジェクトを取得する
  * S3から該当メッセージオブジェクトを削除する

## メッセージ保持期間

* 1分~14日間の範囲内で指定可能
* デフォルトは4日間

## デッドレターキュー

* 非同期呼び出し処理に3回失敗した場合、LambdaはSQSにデッドレターキューとしてイベントを送信できる
* 後で未実行イベントを確認したり、再試行するため

## ショートポーリング/ロングポーリング

* ショートポーリング：
  * `ReceiveMessage`の際、`WaitTimeSeconds`を 0 に設定するか、
  * `ReceiveMessageWaitTimeSeconds`を 0 に設定するとできる。
  * SQSサーバ上の一部をサンプリングして（サブセット）、そこにあるメッセージだけを返す＝速いが取りこぼしがあったり、偽の空応答があったりする
* ロングポーリング：
  * 時間（最大20秒）とメッセージ数が許す限り全てのメッセージを取得して返す＝偽の空応答を減らしてコスト最適化を図る
