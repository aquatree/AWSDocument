# API Gateway

* ステージ
  * APIのライフサイクル状態への論理的なリファレンス（dev, prod. v2等）
  * API ID とステージ名で識別され、URLに含まれる
  * 作成したステージにAPIをデプロイし、クライアントがそれを呼び出せるようになる
  * ステージ変数
    * ステージに定義できるキーバリュー
    * AWS Lambdaエイリアスを利用してステージ変数のパラメータを渡すことが出来る

* 統合タイプ
  * HTTP
    * WEBサーバに対するリクエスト・レスポンスを処理する場合。
    * 統合リクエスト・統合レスポンスのマッピング方法を指定する必要がある。
  * HTTP_PROXY
    * WEBサーバに対するリクエスト・レスポンスを処理する場合。
    * 統合リクエスト・統合レスポンスのマッピング方法を指定する必要はない(やってくれる)。
  * AWS
    * AWSサービスに対するリクエスト・レスポンスを処理する場合。
    * 統合リクエスト・統合レスポンスのマッピング方法を指定する必要がある。
  * AWS_PROXY
    * AWSサービスに対するリクエスト・レスポンスを処理する場合。
    * 統合リクエスト・統合レスポンスのマッピング方法を指定する必要はない(やってくれる)。
    * Lambda用？Lambdaプロキシ統合とも呼ばれる
  * MOCK
    * バックエンドには何も渡さない
    * テスト用

* API Gateway 使用料プラン
  * パブリックAPIを公開して使用。
  * 特定のAPIには、APIキーを持つユーザのみがアクセス可能となる。
  * APIキーには、アクセス可能回数（クォータ）、アクセス頻度（レート）、バーストを設定可能。
  * APIキーごとのアクセス回数を取得することが出来る。

## Lambdaオーソライザー

Lambda関数を使用してAPIへのアクセス制御をする機能。  
クライアントからきたリクエストについて、発信者IDを入力として受け取り、IAMポリシーを出力として返す。

* 以下の二種類がある
  * トークンベースのLambdaオーソライザー
    * JSON WEB TOKEN(JWT)やOAuthトークンなどから発信者IDを受け取る
  * リクエストパラメータベースのLambdaオーソライザー
    * ヘッダー、クエリ文字列パラメータ、stageVariables、$context変数の組合せで発信者IDを受け取る
